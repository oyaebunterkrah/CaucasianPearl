@model CaucasianPearl.Models.EDM.OneNews

@using CaucasianPearl.Core.Constants
@using Resources.News
@using Resources.Shared

@{
    ViewBag.Title = string.Format("{0} | {1}", NewsViewRes.NewsEdition, Consts.Title);
}

<script src="@Url.Content("~/content/scripts/sys/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/content/scripts/sys/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/ckeditor/ckeditor.js")" type="text/javascript"></script>

<script type="text/javascript">
    $(document).ready(function () {
        CKEDITOR.config.customConfig = '@Url.Content("~/ckeditor/ckeditor_config.js")';
        CKEDITOR.replace('Content');
        CKEDITOR.instances['Content'].setData($('#Content').val());

        $('#submit').click(function () {
            $('#Content').val(CKEDITOR.instances['Content'].getData());
        });
    });
</script>

<p>
    @Html.ActionLink(SharedViewRes.Cancel,
        actionName: Consts.Actions.GetByShortName,
        controllerName: Consts.Controllers.OneNews.Name,
        routeValues: new
            {
                shortname = Model.ShortName,
                page = Request.QueryString["page"]
            },
        htmlAttributes: new
            {
                @class = "link"
            })
</p>

<h2>@NewsViewRes.NewsEdition</h2>

<h3>@NewsViewRes.ImageForNews</h3>

@using (Html.BeginForm(
        actionName: Consts.Controllers.OneNews.Actions.UploadImage,
        controllerName: Consts.Controllers.OneNews.Name,
        method: FormMethod.Post,
        htmlAttributes: new
            {
                enctype = "multipart/form-data",
                id = Model.ID
            })
        )
{
    @Html.Hidden("oneNewsId", Model.ID)

    <table>
        <tr>
            <td>
                @{
                    var filename = string.IsNullOrWhiteSpace(Model.ImageExt)
                                       ? Consts.NoImage
                                       : string.Format("{0}{1}", Model.ID, Model.ImageExt.TrimEnd());
                }

                <div class="model-image">
                    <img src='@(Url.Content(Consts.EntityImagesFolder))/@(Consts.Controllers.OneNews.OneNewsImagesFolder)/@(filename)' alt='@Model.Name' />
                </div>
            </td>
            <td style="padding-left: 20px">
                <input type="file" name="imagefile" />
                <br />
                <input type="submit" value="Загрузить" />
            </td>
        </tr>
    </table>
}

@using (Html.BeginForm())
{
    @Html.EditorForModel()

    <input id="submit" type="submit" class="submit" value="@SharedViewRes.Save" />
}
