@using CaucasianPearl.Core.Constants
@using CaucasianPearl.Core.EntityServices.Interface
@using CaucasianPearl.Core.UserControls
@using CaucasianPearl.Core.Helpers
@using CaucasianPearl.Models
@using CaucasianPearl.Models.EDM;
@using Resources.Request
@using Resources.Shared

@model IEnumerable<Request>

@{
    ViewBag.Title = string.Format("{0} - {1}", SharedRes.ProjectTitle, RequestViewRes.Requests);
}

<p>
    @Html.ActionLink(
        SharedViewRes.ToHomePage,
        actionName: Consts.Actions.Index,
        controllerName: Consts.Controllers.Home.Name,
        routeValues: null,
        htmlAttributes: new { @class = "link" }
    )
    @Consts.BreadcrumbsSeparator
    @RequestViewRes.Requests
</p>

<h2>@RequestViewRes.Requests</h2>

<p>
    @Html.ActionLink(
        linkText: RequestViewRes.AddRequest,
        actionName: Consts.Actions.Create)
</p>

@foreach (var request in Model)
{
    <div>
        @request.Name, @request.City, @String.Format("{0:g}", request.RequestDateTime)
        
        <div>
            <span class="display-label">@RequestModelRes.Phone:</span>
            <div class="display-field">
                @request.Phone
            </div>
            
            <span class="display-label">@RequestModelRes.Email:</span>
            <div class="display-field">
                @request.Email
            </div>

            <span class="display-label">@RequestModelRes.Content:</span>
            <div id="@string.Format("requestContent{0}", request.ID)" class="display-field">
                @request.Content
            </div>

            <span class="display-label">@RequestModelRes.Status:</span>
            <div id="@string.Format("requestStatus{0}", request.ID)" class="display-field">
                @request.Status
            </div>
            
            <span class="display-label">@RequestModelRes.Comment:</span>
            <div id="@string.Format("requestComment{0}", request.ID)" class="display-field">
                @request.Comment
            </div>

            @if (WebSecurity.IsAuthenticated && (Roles.IsUserInRole(Consts.Roles.Admin) || Roles.IsUserInRole(Consts.Roles.ContentManager)))
            {
                <p>
                    @Html.ActionLink(
                        linkText: SharedViewRes.Edit,
                        actionName: Consts.Actions.Edit,
                        routeValues: new {id = request.ID}
                         ) |
                    @Html.ActionLink(
                        linkText: SharedViewRes.Delete,
                        actionName: Consts.Actions.Delete,
                        routeValues: new {id = request.ID}
                         )
                </p>
            }
        </div>
        
        @Html.ActionLink(
            linkText: @RequestViewRes.RequestDetails,
            actionName: Consts.Actions.Details,
            routeValues: new {id = request.ID})
    </div>
    
    if (request != Model.Last())
    {
        <hr />
    }
}

<br /><br />

<div class="paginator">
    @Html.Partial(
        Consts.UserControlsPaths.Paginator,
        (PaginatorControl.GetLinks(
            DependencyResolverHelper<IBaseService<Request>>.GetService().Count(Request.QueryString),
            Consts.PaginatorControl.RequestItemsPerPage,
            Consts.PaginatorControl.RequestNumberOfVisibleLinks)
        )
    )
</div>