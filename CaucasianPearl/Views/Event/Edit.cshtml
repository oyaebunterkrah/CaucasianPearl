@using CaucasianPearl.Core.Constants
@using Resources.Event
@using Resources.Shared

@model CaucasianPearl.Models.EDM.Event

@{
    ViewBag.Title = string.Format("{0} | {1}", EventViewRes.EventEditing, Consts.Title);
}

<script src="@Url.Content("~/content/js/sys/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/content/js/sys/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
<script src="@Url.Content(Consts.JsPaths.CKEditor)" type="text/javascript"></script>

<p>
    <!-- Отмена -->
    @Html.ActionLink(
        linkText: SharedViewRes.Cancel,
        actionName: Consts.Actions.GetByShortName,
        controllerName: Consts.Controllers.Event.Name,
        routeValues: new
            {
                shortname = Model.ShortName,
                page = Request.QueryString["page"]
            },
        htmlAttributes: new { @class = "link" })
    
    <br /><br />

    <!-- Удалить -->
    @Html.ActionLink(
        SharedViewRes.Delete, actionName: Consts.Actions.Delete,
        controllerName: Consts.Controllers.Event.Name,
        routeValues: new { id = Model.ID },
        htmlAttributes: new { @class = "link" })
</p>

<h2>@EventViewRes.EventEditing</h2>

<h3>@EventViewRes.ImageForEvent</h3>
    
@using (Html.BeginForm(
    actionName: Consts.Controllers.Event.Actions.UploadImage,
    controllerName: Consts.Controllers.Event.Name,
    method: FormMethod.Post,
    htmlAttributes: new
        {
            enctype = "multipart/form-data"
        }))
{
    @Html.HiddenFor(model => model.ID)

    @*<table>
        <tr>
            <td>
                @{
    var filename = string.IsNullOrWhiteSpace(Model.ImageExt)
                       ? Consts.NoImage
                       : string.Format("{0}{1}", Model.ID, Model.ImageExt.TrimEnd());
                }

                <div class="model-image">
                    <img src='@(Url.Content(Consts.EntityImagesFolder))/@(Consts.Controllers.Event.EventImagesFolder)/@(filename)' alt='@Model.Name' />
                </div>
            </td>
            <td style="padding-left: 20px">
                <input type="file" name="imagefile" />
                <br />
                <input type="submit" value="Загрузить" />
            </td>
        </tr>
    </table>*@
}

@using (Html.BeginForm())
{
    @Html.ValidationSummary(true)

    <fieldset>
        <legend>@EventViewRes.Events</legend>

        @Html.HiddenFor(model => model.ID)

		@Html.Partial(Consts.Views.CreateOrEdit, Model)
        
        @{ Html.RenderPartial(Consts.Controllers.Event.Views.SelectFlickrObjsOnEdit, Model, new ViewDataDictionary { { "mode", "edit" } }); }

        <input id="submit" type="submit" value="@SharedViewRes.Save" />
    </fieldset>
}

<script type="text/javascript">
    replaceByCKEditor('@Url.Content(Consts.JsPaths.CKEditorConfig)', 'Description', 'submit');
    
    var eventMedia = [];
    @foreach (var flickrObj in Model.EventMedia)
    {
        @:eventMedia.push('@flickrObj.PhotoId');
    }
</script>

@{ Html.RenderPartial(Consts.Controllers.Event.Views.SelectFlickrObjsOnCreate, Model, new ViewDataDictionary { { "mode", "edit" } }); }